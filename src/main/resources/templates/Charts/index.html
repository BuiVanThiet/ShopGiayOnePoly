<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{Home/home_manege}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="/css/Chart/chart.css">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <title>Thống kê</title>
  <style>
    #chart_div {
      width: 100%; /* Đặt chiều rộng là 100% của phần tử chứa */
      height: 600px; /* Đặt chiều cao cho biểu đồ */
    }
  </style>
</head>

<body>

<main class="container">
  <div layout:fragment="content">
    <h2 class="text-center custom-heading">THỐNG KÊ</h2>
    <div class="row">
      <div class="col-md-4">
        <div class="rectangle">
          <h6>Doanh số hôm nay</h6>
          <p class="data-from-be"><span th:text="${billOfTheDay} + ' Đơn hàng /'"></span>
            <span th:text="${totalPriceToday} + 'VND'"></span></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="rectangle">
          <h6>Doanh số tháng này</h6>
          <p class="data-from-be"><span th:text="${monthlyBill} + ' Đơn hàng /'"></span>
            <span  class="total-amount" th:text="${totalMonthlyBill} +'VND'"></span></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="rectangle">
          <h6>Hàng bán được tháng này</h6>
          <p class="data-from-be"><span th:text="${totalMonthlyInvoiceProducts} + ' Sản phẩm'"></span></p>
        </div>
      </div>
    </div>

    <div class="filter-section">
      <form action="#" method="GET" class="custom-form-inline">
        <!-- Bộ lọc khoảng thời gian -->
        <div class="button-group" role="group" aria-label="Thời gian lọc">
          <button type="button" class="custom-btn" onclick="filterData('today')">Hôm nay</button>
          <button type="button" class="custom-btn" onclick="filterData('last7days')">7 Ngày</button>
          <button type="button" class="custom-btn" onclick="filterData('month')">Tháng</button>
          <button type="button" class="custom-btn" onclick="filterData('year')">Năm</button>
        </div>
      </form>
    </div>

    <div class="row mt-4">
      <div class="col-md-12">
        <div id="chart_div"></div>
        <script>
          google.charts.load('current', {packages: ['corechart', 'bar']});
          google.charts.setOnLoadCallback(drawMultSeries);

          function drawMultSeries() {
            fetch('/api/statistics') // Gọi API để lấy dữ liệu
                    .then(response => response.json())
                    .then(data => {
                      var googleData = new google.visualization.DataTable();
                      googleData.addColumn('string', 'Tháng');
                      googleData.addColumn('number', 'Sản phẩm');
                      googleData.addColumn('number', 'Hóa đơn');

                      // Thêm dữ liệu vào googleData từ dữ liệu nhận được
                      data.forEach(item => {
                        googleData.addRow([item.month, item.productCount, item.invoiceCount]);
                      });

                      var options = {
                        title: 'Biểu đồ thống kê sản phẩm và hóa đơn',
                        titleTextStyle: {
                          alignment: 'center'
                        },
                        vAxis: {
                          title: 'Số lượng'
                        },
                        hAxis: {
                          title: 'Tháng'
                        },
                        seriesType: 'bars',
                        series: {
                          0: { type: 'bars', label: 'Sản phẩm' },
                          1: { type: 'bars', label: 'Hóa đơn' }
                        },

                      };

                      var chart = new google.visualization.ColumnChart(
                              document.getElementById('chart_div')
                      );

                      chart.draw(googleData, options);
                    })
                    .catch(error => console.error('Lỗi khi lấy dữ liệu:', error));
          }
        </script>
      </div>
    </div>
  </div>
</main>

<script th:src="@{/js/chart/chart.js}" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>